<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Whack-a-Epstein</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Orbitron:wght@500;700;900&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-deep: #0a0a1a;
    --bg-mid: #111128;
    --bg-panel: rgba(20, 20, 50, 0.7);
    --accent: #e94560;
    --accent-glow: rgba(233, 69, 96, 0.4);
    --accent-bright: #ff3d5a;
    --gold: #ffd700;
    --gold-glow: rgba(255, 215, 0, 0.3);
    --text: #eee;
    --text-dim: #888;
    --hole-bg: #0c0c22;
    --hole-border: #1a1a4a;
    --hole-hover: #e94560;
    --radius: 16px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg-deep);
    font-family: 'Inter', 'Segoe UI', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    color: var(--text);
    user-select: none;
    overflow-x: hidden;
    position: relative;
  }

  /* ---- Animated background ---- */
  .bg-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 0;
    pointer-events: none;
  }

  .game-wrapper {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    padding-bottom: 40px;
  }

  /* ---- Intro / Splash Screen ---- */
  .intro-overlay {
    position: fixed;
    inset: 0;
    z-index: 1000;
    background: var(--bg-deep);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: opacity 0.6s ease, visibility 0.6s ease;
  }
  .intro-overlay.hidden {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
  }
  .intro-title {
    font-family: 'Russo One', sans-serif;
    font-size: 4rem;
    color: var(--accent);
    text-shadow: 0 0 40px var(--accent-glow), 0 0 80px var(--accent-glow);
    letter-spacing: 3px;
    animation: introGlow 2s ease-in-out infinite alternate;
    text-align: center;
    line-height: 1.1;
  }
  @keyframes introGlow {
    from { text-shadow: 0 0 20px var(--accent-glow), 0 0 40px var(--accent-glow); }
    to   { text-shadow: 0 0 40px var(--accent-glow), 0 0 100px var(--accent-glow), 0 0 150px rgba(233,69,96,0.15); }
  }
  .intro-sub {
    font-family: 'Inter', sans-serif;
    color: var(--text-dim);
    font-style: italic;
    font-size: 1.2rem;
    margin-top: 10px;
    opacity: 0.7;
  }
  .intro-music-box {
    margin-top: 50px;
    background: var(--bg-panel);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(233, 69, 96, 0.2);
    border-radius: var(--radius);
    padding: 30px 40px;
    text-align: center;
    max-width: 420px;
    animation: fadeSlideUp 0.8s ease-out 0.3s both;
  }
  @keyframes fadeSlideUp {
    from { opacity: 0; transform: translateY(30px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  .intro-music-box h3 {
    font-family: 'Orbitron', sans-serif;
    font-size: 1rem;
    color: var(--gold);
    margin-bottom: 12px;
    letter-spacing: 2px;
    text-transform: uppercase;
  }
  .intro-music-box p {
    color: var(--text-dim);
    font-size: 0.9rem;
    margin-bottom: 20px;
    line-height: 1.4;
  }
  .intro-btns {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .intro-btn {
    padding: 14px 32px;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.9rem;
    font-weight: 700;
    border: 2px solid var(--accent);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.25s ease;
    letter-spacing: 1px;
    text-transform: uppercase;
  }
  .intro-btn.primary {
    background: var(--accent);
    color: #fff;
    box-shadow: 0 0 20px var(--accent-glow);
  }
  .intro-btn.primary:hover {
    background: var(--accent-bright);
    box-shadow: 0 0 35px var(--accent-glow), 0 0 60px var(--accent-glow);
    transform: scale(1.05);
  }
  .intro-btn.secondary {
    background: transparent;
    color: var(--text-dim);
    border-color: rgba(255,255,255,0.15);
  }
  .intro-btn.secondary:hover {
    border-color: var(--accent);
    color: var(--text);
    transform: scale(1.05);
  }

  /* ---- Header ---- */
  .header {
    text-align: center;
    padding: 20px 20px 0;
  }
  .header h1 {
    font-family: 'Russo One', sans-serif;
    font-size: 2.8rem;
    color: var(--accent);
    text-shadow: 0 0 30px var(--accent-glow);
    letter-spacing: 2px;
  }
  .subtitle {
    font-family: 'Inter', sans-serif;
    color: var(--text-dim);
    font-style: italic;
    font-size: 0.95rem;
    margin-top: 2px;
    opacity: 0.6;
  }

  /* ---- HUD ---- */
  .hud-bar {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    flex-wrap: wrap;
    margin: 14px 10px 6px;
    width: 100%;
    max-width: 900px;
  }
  .hud-card {
    background: var(--bg-panel);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 12px;
    padding: 10px 20px;
    text-align: center;
    min-width: 100px;
    transition: border-color 0.3s;
  }
  .hud-card:hover { border-color: rgba(233, 69, 96, 0.3); }
  .hud-label {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.6rem;
    color: var(--text-dim);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 4px;
  }
  .hud-value {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.5rem;
    font-weight: 900;
    color: var(--accent);
    text-shadow: 0 0 10px var(--accent-glow);
  }
  .hud-value.gold {
    color: var(--gold);
    text-shadow: 0 0 10px var(--gold-glow);
  }
  .hud-lives {
    font-size: 1.4rem;
    letter-spacing: 3px;
  }
  .hud-lives .lost { opacity: 0.15; filter: grayscale(1); }

  .zone-hint {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.6rem;
    color: var(--text-dim);
    letter-spacing: 2px;
    margin-bottom: 6px;
    opacity: 0.5;
  }

  .speed-label {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.7rem;
    font-weight: 700;
    color: var(--accent);
    letter-spacing: 3px;
    text-shadow: 0 0 8px var(--accent-glow);
    margin-bottom: 4px;
  }

  /* ---- Game Area ---- */
  .game-area {
    display: flex;
    align-items: flex-start;
    gap: 25px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .board {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
    padding: 14px;
    background: var(--bg-panel);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.04);
    border-radius: 20px;
  }

  .hole {
    width: 160px;
    height: 180px;
    background: radial-gradient(ellipse at center, var(--hole-bg) 60%, #06061a 100%);
    border-radius: 50%;
    border: 3px solid var(--hole-border);
    position: relative;
    overflow: hidden;
    cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><text y="28" font-size="28">ðŸ”¨</text></svg>') 16 16, pointer;
    transition: border-color 0.25s, box-shadow 0.25s;
    box-shadow: inset 0 8px 20px rgba(0,0,0,0.6), 0 0 0 0 transparent;
  }
  .hole:hover {
    border-color: var(--hole-hover);
    box-shadow: inset 0 8px 20px rgba(0,0,0,0.6), 0 0 25px var(--accent-glow);
  }
  .hole::after {
    content: '';
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 38%;
    background: linear-gradient(to top, #06061a 5%, transparent);
    border-radius: 0 0 50% 50%;
    pointer-events: none;
    z-index: 3;
  }

  .mole {
    position: absolute;
    bottom: -120%;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 150px;
    transition: bottom 0.2s ease-out;
    pointer-events: none;
    z-index: 1;
  }
  .mole img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: top;
    border-radius: 10px;
    pointer-events: none;
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
  }
  .mole.up { bottom: 5%; pointer-events: auto; }
  .mole.bonked { bottom: 5%; pointer-events: none; }

  /* ---- Hammer & Impact ---- */
  .hammer {
    position: absolute; z-index: 20;
    width: 70px; height: 70px;
    pointer-events: none;
    animation: hammerSmash 0.35s ease-in forwards;
  }
  @keyframes hammerSmash {
    0%  { transform: translate(-50%, -80%) rotate(-45deg) scale(1.3); opacity: 1; }
    30% { transform: translate(-50%, -30%) rotate(15deg)  scale(1.5); opacity: 1; }
    50% { transform: translate(-50%, -10%) rotate(0deg)   scale(1.6); opacity: 1; }
    60% { transform: translate(-50%, -10%) rotate(0deg)   scale(1.6); opacity: 1; }
    100%{ transform: translate(-50%, -40%) rotate(-20deg)  scale(1);   opacity: 0; }
  }

  .blood-drop {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    z-index: 18;
    animation: bloodFly var(--dur) ease-out forwards;
  }
  @keyframes bloodFly {
    0%   { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
    40%  { opacity: 1; }
    100% { transform: translate(var(--tx), var(--ty)) scale(var(--sc)); opacity: 0; }
  }
  .blood-splat {
    position: absolute;
    pointer-events: none;
    z-index: 17;
    animation: splatGrow 0.5s ease-out forwards;
  }
  @keyframes splatGrow {
    0%  { transform: translate(-50%, -50%) scale(0);   opacity: 0.9; }
    50% { transform: translate(-50%, -50%) scale(1.3); opacity: 0.8; }
    100%{ transform: translate(-50%, -50%) scale(1);   opacity: 0; }
  }

  .impact {
    position: absolute; z-index: 15;
    width: 100px; height: 100px;
    pointer-events: none;
    animation: impactFlash 0.3s ease-out forwards;
  }
  @keyframes impactFlash {
    0%  { transform: translate(-50%, -50%) scale(0.2); opacity: 1; }
    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; }
    100%{ transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
  }

  /* ---- Score Pop ---- */
  .score-pop {
    position: absolute; left: 50%;
    transform: translateX(-50%);
    font-family: 'Orbitron', sans-serif;
    font-size: 1.2rem; font-weight: 700;
    animation: popUp 0.8s ease-out forwards;
    pointer-events: none; z-index: 25;
    text-shadow: 0 2px 8px rgba(0,0,0,0.9);
    white-space: nowrap;
    letter-spacing: 1px;
  }
  .score-pop.head  { color: var(--gold); top: 5%; }
  .score-pop.groin { color: #ff00ff; top: 60%; }
  .score-pop.body  { color: var(--accent); top: 30%; }
  @keyframes popUp {
    0%  { opacity: 1; transform: translateX(-50%) translateY(0)     scale(1);   }
    30% { transform: translateX(-50%) translateY(-10px) scale(1.4); }
    100%{ opacity: 0; transform: translateX(-50%) translateY(-50px) scale(0.8); }
  }

  /* ---- Buttons ---- */
  .btn {
    margin: 18px;
    padding: 14px 50px;
    font-family: 'Orbitron', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    background: var(--accent);
    color: #fff;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.25s ease;
    box-shadow: 0 0 20px var(--accent-glow), 0 4px 15px rgba(0,0,0,0.4);
  }
  .btn:hover {
    background: var(--accent-bright);
    box-shadow: 0 0 40px var(--accent-glow), 0 0 60px var(--accent-glow);
    transform: scale(1.06);
  }
  .btn:active { transform: scale(0.95); }

  /* ---- Game Over ---- */
  .game-over {
    display: none;
    flex-direction: column;
    align-items: center;
    margin-top: 20px;
    background: var(--bg-panel);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(233, 69, 96, 0.2);
    border-radius: 20px;
    padding: 30px 40px;
    animation: fadeSlideUp 0.5s ease-out;
  }
  .game-over h2 {
    font-family: 'Russo One', sans-serif;
    font-size: 2.2rem;
    color: var(--accent);
    margin-bottom: 15px;
    text-shadow: 0 0 30px var(--accent-glow);
    letter-spacing: 3px;
  }
  .game-over .final {
    font-family: 'Inter', sans-serif;
    font-size: 1.1rem;
    margin-bottom: 6px;
    color: var(--text-dim);
  }
  .game-over .final span {
    color: var(--text);
    font-weight: 700;
  }
  .game-over #verdict {
    font-style: italic;
    color: var(--text-dim);
    margin-top: 10px;
    font-size: 0.95rem;
  }

  /* ---- Miss flash ---- */
  .miss-flash { animation: missFlash 0.4s; }
  @keyframes missFlash {
    0%  { border-color: var(--hole-border); }
    50% { border-color: #ff0000; box-shadow: inset 0 8px 20px rgba(0,0,0,0.6), 0 0 30px rgba(255,0,0,0.6); }
    100%{ border-color: var(--hole-border); }
  }
  .shake { animation: shake 0.3s ease-out; }
  @keyframes shake {
    0%, 100% { transform: translateX(-50%); }
    20%  { transform: translateX(calc(-50% + 8px))  rotate(5deg); }
    40%  { transform: translateX(calc(-50% - 8px))  rotate(-5deg); }
    60%  { transform: translateX(calc(-50% + 4px))  rotate(2deg); }
    80%  { transform: translateX(calc(-50% - 4px))  rotate(-2deg); }
  }

  /* ---- Alex Jones Panel ---- */
  .alex-panel {
    width: 230px;
    text-align: center;
    padding: 15px;
    background: var(--bg-panel);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.04);
    border-radius: 20px;
  }
  .alex-panel img {
    width: 195px; height: 195px;
    object-fit: cover; object-position: top;
    border-radius: 14px;
    border: 3px solid rgba(255,255,255,0.08);
    transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
  }
  .alex-panel img.hyped {
    border-color: var(--accent);
    transform: scale(1.08);
    box-shadow: 0 0 30px var(--accent-glow);
    animation: alexBounce 0.4s ease-out;
  }
  @keyframes alexBounce {
    0%  { transform: scale(1); }
    30% { transform: scale(1.15) rotate(-3deg); }
    60% { transform: scale(1.08) rotate(2deg); }
    100%{ transform: scale(1.08) rotate(0deg); }
  }
  .alex-quote {
    margin-top: 12px;
    font-family: 'Russo One', sans-serif;
    font-size: 0.85rem;
    color: var(--accent);
    min-height: 55px;
    line-height: 1.35;
    text-shadow: 0 0 10px var(--accent-glow);
  }
  .alex-label {
    font-family: 'Orbitron', sans-serif;
    color: var(--text-dim);
    font-size: 0.6rem;
    margin-top: 8px;
    letter-spacing: 2px;
    text-transform: uppercase;
    opacity: 0.5;
  }
  .volume-ctrl { margin-top: 10px; }
  .volume-ctrl label {
    font-family: 'Orbitron', sans-serif;
    color: var(--text-dim);
    font-size: 0.55rem;
    letter-spacing: 1px;
    text-transform: uppercase;
  }
  .volume-ctrl input[type="range"] {
    width: 130px;
    margin-top: 4px;
    accent-color: var(--accent);
  }

  /* ---- Music controls (in-game) ---- */
  .music-ctrl {
    display: none;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
    padding-top: 10px;
    border-top: 1px solid rgba(255,255,255,0.06);
  }
  .music-ctrl.active { display: flex; }
  .music-ctrl label {
    font-family: 'Orbitron', sans-serif;
    color: var(--text-dim);
    font-size: 0.55rem;
    letter-spacing: 1px;
    text-transform: uppercase;
    white-space: nowrap;
  }
  .music-ctrl input[type="range"] {
    width: 80px;
    accent-color: var(--gold);
  }
  .music-toggle {
    background: none;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 6px;
    color: var(--text-dim);
    font-size: 1rem;
    padding: 2px 8px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .music-toggle:hover {
    border-color: var(--gold);
    color: var(--gold);
  }

  /* ---- Screen effects ---- */
  .screen-shake { animation: screenShake 0.2s ease-out; }
  @keyframes screenShake {
    0%, 100% { transform: translate(0,0); }
    25%  { transform: translate(-4px, 3px); }
    50%  { transform: translate(4px, -3px); }
    75%  { transform: translate(-2px, 2px); }
  }

  .life-lost-flash { animation: lifeLost 0.5s ease-out; }
  @keyframes lifeLost {
    0%  { box-shadow: inset 0 0 0 0 rgba(255,0,0,0); }
    30% { box-shadow: inset 0 0 100px 50px rgba(255,0,0,0.3); }
    100%{ box-shadow: inset 0 0 0 0 rgba(255,0,0,0); }
  }

  /* ---- Scanline overlay ---- */
  .scanlines {
    position: fixed;
    inset: 0;
    z-index: 999;
    pointer-events: none;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0, 0, 0, 0.03) 2px,
      rgba(0, 0, 0, 0.03) 4px
    );
  }

  /* ---- Footer ---- */
  .footer {
    margin-top: 30px;
    padding: 15px;
    text-align: center;
    font-size: 0.65rem;
    color: rgba(255,255,255,0.15);
    font-family: 'Orbitron', sans-serif;
    letter-spacing: 2px;
  }
</style>
</head>
<body>

<!-- Subtle CRT scanlines overlay -->
<div class="scanlines"></div>

<!-- Animated particle background -->
<canvas class="bg-canvas" id="bgCanvas"></canvas>

<!-- ---- INTRO SCREEN ---- -->
<div class="intro-overlay" id="introOverlay">
  <div class="intro-title">WHACK-A-EPSTEIN</div>
  <p class="intro-sub">"He didn't whack himself"</p>
  <div class="intro-music-box">
    <h3>Background Music</h3>
    <p>Play background music during the game?</p>
    <div class="intro-btns">
      <button class="intro-btn primary" id="introMusicYes">Play with Music</button>
      <button class="intro-btn secondary" id="introMusicNo">No Music</button>
    </div>
  </div>
</div>

<!-- ---- GAME UI ---- -->
<div class="game-wrapper" id="gameWrapper">
  <div class="header">
    <h1>Whack-a-Epstein</h1>
    <p class="subtitle">"He didn't whack himself"</p>
  </div>

  <p class="zone-hint">HEADSHOT = 2x &nbsp; | &nbsp; BODY = 1x &nbsp; | &nbsp; BELOW THE BELT = 5x</p>

  <div class="hud-bar">
    <div class="hud-card">
      <div class="hud-label">Score</div>
      <div class="hud-value" id="score">0</div>
    </div>
    <div class="hud-card">
      <div class="hud-label">Combo</div>
      <div class="hud-value gold" id="combo">0</div>
    </div>
    <div class="hud-card">
      <div class="hud-label">Lives</div>
      <div class="hud-lives" id="livesDisplay">&#10084;&#65039;&#10084;&#65039;&#10084;&#65039;</div>
    </div>
    <div class="hud-card">
      <div class="hud-label">Speed</div>
      <div class="hud-value" id="speedLabel" style="font-size:0.9rem;">EASY</div>
    </div>
  </div>

  <div class="game-area">
    <div class="board" id="board"></div>
    <div class="alex-panel" id="alexPanel">
      <img id="alexImg" src="https://images.foxtv.com/static.fox4news.com/www.fox4news.com/content/uploads/2019/08/1280/720/1b228377-alex20jones_1533587354775.jpg_5892739_ver1.0_640_360.jpg?ve=1&tl=1" alt="Alex Jones">
      <div class="alex-quote" id="alexQuote">Hit START and take down the globalists!</div>
      <div class="alex-label">Your Hype Man</div>
      <div class="volume-ctrl">
        <label>Alex Volume</label><br>
        <input type="range" id="alexVol" min="0" max="100" value="70">
      </div>
      <div class="music-ctrl" id="musicCtrl">
        <button class="music-toggle" id="musicToggle" title="Toggle music">&#9834;</button>
        <label>Music</label>
        <input type="range" id="musicVol" min="0" max="100" value="50">
      </div>
    </div>
  </div>

  <button class="btn" id="startBtn">Start Game</button>

  <div class="game-over" id="gameOver">
    <h2>GAME OVER</h2>
    <p class="final">Final Score: <span id="finalScore">0</span></p>
    <p class="final">Headshots: <span id="finalHead">0</span> &nbsp;|&nbsp; Body: <span id="finalBody">0</span> &nbsp;|&nbsp; Groin: <span id="finalGroin">0</span></p>
    <p class="final">Best Combo: <span id="finalCombo">0</span>x &nbsp;|&nbsp; Round: <span id="finalRound">0</span></p>
    <p id="verdict"></p>
    <button class="btn" id="restartBtn">Play Again</button>
  </div>

  <div class="footer">Whack-a-Epstein &bull; He didn't whack himself</div>
</div>

<script>
// ================================================================
//  BACKGROUND MUSIC (EFN.mp3)
// ================================================================
let bgMusic = null;
let musicEnabled = false;

function initMusic() {
  bgMusic = new Audio('EFN.mp3');
  bgMusic.loop = true;
  bgMusic.volume = 0.5;
  musicEnabled = true;
  document.getElementById('musicCtrl').classList.add('active');
}

document.getElementById('introMusicYes').addEventListener('click', () => {
  initMusic();
  dismissIntro();
  // Try playing immediately - will start once game starts or on interaction
  bgMusic.play().catch(() => {});
});

document.getElementById('introMusicNo').addEventListener('click', () => {
  dismissIntro();
});

function dismissIntro() {
  document.getElementById('introOverlay').classList.add('hidden');
}

// Music volume slider
document.getElementById('musicVol').addEventListener('input', (e) => {
  if (bgMusic) bgMusic.volume = e.target.value / 100;
});

// Music toggle button
document.getElementById('musicToggle').addEventListener('click', () => {
  if (!bgMusic) return;
  if (bgMusic.paused) {
    bgMusic.play().catch(() => {});
    document.getElementById('musicToggle').textContent = '\u266A';
    document.getElementById('musicToggle').style.color = '';
  } else {
    bgMusic.pause();
    document.getElementById('musicToggle').textContent = '\u2716';
    document.getElementById('musicToggle').style.color = '#ff4444';
  }
});

// ================================================================
//  ANIMATED BACKGROUND
// ================================================================
(function() {
  const canvas = document.getElementById('bgCanvas');
  const ctx = canvas.getContext('2d');
  let particles = [];
  const COUNT = 50;

  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener('resize', resize);

  for (let i = 0; i < COUNT; i++) {
    particles.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      vx: (Math.random() - 0.5) * 0.3,
      vy: (Math.random() - 0.5) * 0.3,
      r: 1 + Math.random() * 2,
      a: 0.1 + Math.random() * 0.2,
    });
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw connections
    for (let i = 0; i < particles.length; i++) {
      for (let j = i + 1; j < particles.length; j++) {
        const dx = particles[i].x - particles[j].x;
        const dy = particles[i].y - particles[j].y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < 150) {
          ctx.beginPath();
          ctx.moveTo(particles[i].x, particles[i].y);
          ctx.lineTo(particles[j].x, particles[j].y);
          ctx.strokeStyle = `rgba(233, 69, 96, ${0.06 * (1 - dist / 150)})`;
          ctx.lineWidth = 0.5;
          ctx.stroke();
        }
      }
    }

    // Draw particles
    for (const p of particles) {
      p.x += p.vx;
      p.y += p.vy;
      if (p.x < 0) p.x = canvas.width;
      if (p.x > canvas.width) p.x = 0;
      if (p.y < 0) p.y = canvas.height;
      if (p.y > canvas.height) p.y = 0;

      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(233, 69, 96, ${p.a})`;
      ctx.fill();
    }

    requestAnimationFrame(draw);
  }
  draw();
})();

// ================================================================
//  GAME CONSTANTS
// ================================================================
const HOLES = 9;
const MAX_LIVES = 3;

const IMAGES = [
  'https://i.abcnewsfe.com/a/a730ee0c-6d4d-4c6c-ae79-c225ce30bd58/epstein-5-ht-gmh-251219_1766184620739_hpEmbed_2_25x16.jpg?w=1500',
  'https://npr.brightspotcdn.com/dims3/default/strip/false/crop/3600x2400+0+0/resize/1100/quality/50/format/jpeg/?url=http%3A%2F%2Fnpr-brightspot.s3.amazonaws.com%2F1d%2Fa4%2F3b45080d4eebbe1e5183d165aa81%2Fgettyimages-590696434.jpg',
  'https://www.aljazeera.com/wp-content/uploads/2025/07/GettyImages-1192977790-1752836036.jpg?resize=770%2C513&quality=80',
  'https://pbs.twimg.com/media/HAUsL-SW8AAzJUn.jpg',
  'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRlP5BVESiUFWzbTyJA_MWVTZjPuT1u9NlILA&s',
  'https://www.washingtonpost.com/wp-apps/imrs.php?src=https://arc-anglerfish-washpost-prod-washpost.s3.amazonaws.com/public/ATK2LIVIWMI6TBZTJDEHENPTSY.jpg&w=1440&impolicy=high_res',
  'https://static01.nyt.com/images/2021/12/01/nyregion/01maxwell-trial-epstein-suicide01/01maxwell-trial-epstein-suicide01-mediumSquareAt3X.jpg',
  'https://live-production.wcms.abc-cdn.net.au/26f50e2a701b359b949b3b73721cfcac?impolicy=wcms_crop_resize&cropH=765&cropW=765&xPos=131&yPos=0&width=862&height=862',
  'https://d3i6fh83elv35t.cloudfront.net/static/2025/12/billclinton3-1024x793.jpg'
];

// ---- Alex Jones Voice Clips ----
const MI = 'https://www.myinstants.com/media/sounds/';
const ALEX_CLIPS = {
  hit: [
    MI + 'alex-jones-yell.mp3',
    MI + 'illbeatyoass_2jcnXDq.mp3',
    MI + 'alex-jones-ill-beat-your-ass.mp3',
    MI + 'alex-jones-you-sob.mp3',
  ],
  bigHit: [
    MI + 'uuuuuaaaaaarrrrrrruuuuaaaaaaggghhhh_jtvTsZ9.mp3',
    MI + 'alex-jones-scream-1.mp3',
    MI + 'destroy-the-child.mp3',
  ],
  combo: [
    MI + 'alex-jones-against-piers-morgan-on-2nd-ammendment-1776-will-commence-again-clip.mp3',
    MI + 'alex-jones-goblins.mp3',
  ],
  miss: [
    MI + 'alex-jones-scan.mp3',
  ],
  start: [
    MI + 'c290b740-0cc7-11e9-9d86-05fde4d5e89f.mp3',
  ],
};

const ALEX_QUOTES = {
  head: [
    "RIGHT IN THE GLOBALIST HEAD!",
    "THAT'S WHAT I'M TALKING ABOUT!",
    "HEADSHOT! THE TRUTH PREVAILS!",
    "BOOM! CRITICAL HIT ON THE ELITE!",
  ],
  groin: [
    "BELOW THE BELT!! THAT'S FOR THE CHILDREN!!!",
    "HE WON'T BE TRAFFICKING ANYMORE!",
    "JUSTICE IS SERVED... DOWN THERE!",
    "THE GLOBALISTS CAN'T REPRODUCE NOW!",
  ],
  body: [
    "YEAH! GET HIM!",
    "KEEP HITTING! DON'T STOP!",
    "THE PEOPLE ARE FIGHTING BACK!",
    "HIT HIM AGAIN!",
  ],
  combo: [
    "UNSTOPPABLE PATRIOT!!",
    "THEY CAN'T STOP US!",
    "THE AWAKENING IS HERE!",
    "WE HAVE THE DOCUMENTS!",
  ],
  miss: [
    "HE GOT AWAY! GET HIM NEXT TIME!",
    "THEY'RE TRYING TO ESCAPE!",
    "DON'T LET THE ELITES WIN!",
    "FOCUS! THE TRUTH NEEDS YOU!",
  ],
  start: ["IT'S GO TIME! TAKE 'EM DOWN!"],
  end: ["THE FIGHT CONTINUES TOMORROW, PATRIOT."],
};

// ================================================================
//  AUDIO ENGINE
// ================================================================
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let currentAlexAudio = null;

function getAlexVolume() {
  return document.getElementById('alexVol').value / 100;
}

function playAlexClip(category) {
  const clips = ALEX_CLIPS[category];
  if (!clips || clips.length === 0) return;
  const url = clips[Math.floor(Math.random() * clips.length)];
  if (currentAlexAudio) {
    currentAlexAudio.pause();
    currentAlexAudio.currentTime = 0;
  }
  const audio = new Audio(url);
  audio.volume = getAlexVolume();
  audio.play().catch(() => {});
  currentAlexAudio = audio;
}

function playWhack(zone) {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.frequency.setValueAtTime(200, audioCtx.currentTime);
  osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.15);
  gain.gain.setValueAtTime(0.6, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.2);
  osc.start(audioCtx.currentTime);
  osc.stop(audioCtx.currentTime + 0.2);

  const bufferSize = audioCtx.sampleRate * 0.1;
  const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
  const data = buffer.getChannelData(0);
  for (let i = 0; i < bufferSize; i++) data[i] = (Math.random() * 2 - 1) * (1 - i / bufferSize);
  const noise = audioCtx.createBufferSource();
  noise.buffer = buffer;
  const ng = audioCtx.createGain();
  noise.connect(ng); ng.connect(audioCtx.destination);
  ng.gain.setValueAtTime(0.4, audioCtx.currentTime);
  ng.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
  noise.start(audioCtx.currentTime);

  if (zone === 'head') {
    const c = audioCtx.createOscillator();
    const cg = audioCtx.createGain();
    c.connect(cg); cg.connect(audioCtx.destination);
    c.frequency.setValueAtTime(800, audioCtx.currentTime);
    c.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.08);
    cg.gain.setValueAtTime(0.5, audioCtx.currentTime);
    cg.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
    c.start(audioCtx.currentTime); c.stop(audioCtx.currentTime + 0.1);
  }
  if (zone === 'groin') {
    const s = audioCtx.createOscillator();
    const sg = audioCtx.createGain();
    s.type = 'sawtooth'; s.connect(sg); sg.connect(audioCtx.destination);
    s.frequency.setValueAtTime(300, audioCtx.currentTime + 0.05);
    s.frequency.exponentialRampToValueAtTime(30, audioCtx.currentTime + 0.3);
    sg.gain.setValueAtTime(0.3, audioCtx.currentTime + 0.05);
    sg.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
    s.start(audioCtx.currentTime + 0.05); s.stop(audioCtx.currentTime + 0.3);

    const y = audioCtx.createOscillator();
    const yg = audioCtx.createGain();
    y.connect(yg); yg.connect(audioCtx.destination);
    y.frequency.setValueAtTime(600, audioCtx.currentTime + 0.08);
    y.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.15);
    y.frequency.exponentialRampToValueAtTime(400, audioCtx.currentTime + 0.3);
    yg.gain.setValueAtTime(0.25, audioCtx.currentTime + 0.08);
    yg.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.35);
    y.start(audioCtx.currentTime + 0.08); y.stop(audioCtx.currentTime + 0.35);
  }
}

function playMissSound() {
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.connect(g); g.connect(audioCtx.destination);
  o.frequency.setValueAtTime(400, audioCtx.currentTime);
  o.frequency.exponentialRampToValueAtTime(80, audioCtx.currentTime + 0.4);
  g.gain.setValueAtTime(0.2, audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.4);
  o.start(audioCtx.currentTime); o.stop(audioCtx.currentTime + 0.4);
}

// ================================================================
//  GAME STATE
// ================================================================
let score = 0;
let combo = 0;
let bestCombo = 0;
let headshots = 0;
let bodyshots = 0;
let groinshots = 0;
let lives = MAX_LIVES;
let round = 0;
let moleTimeout = null;
let running = false;
let lastHole = -1;
let totalWhacks = 0;

const board = document.getElementById('board');
const scoreEl = document.getElementById('score');
const comboEl = document.getElementById('combo');
const livesDisplay = document.getElementById('livesDisplay');
const speedLabel = document.getElementById('speedLabel');
const startBtn = document.getElementById('startBtn');
const gameOver = document.getElementById('gameOver');
const finalScore = document.getElementById('finalScore');
const finalHead = document.getElementById('finalHead');
const finalBody = document.getElementById('finalBody');
const finalGroin = document.getElementById('finalGroin');
const finalCombo = document.getElementById('finalCombo');
const finalRound = document.getElementById('finalRound');
const verdict = document.getElementById('verdict');
const restartBtn = document.getElementById('restartBtn');
const alexImg = document.getElementById('alexImg');
const alexQuote = document.getElementById('alexQuote');

const hammerSVG = `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
  <rect x="28" y="30" width="8" height="30" rx="3" fill="#8B4513"/>
  <rect x="10" y="8" width="44" height="24" rx="5" fill="#888"/>
  <rect x="12" y="10" width="40" height="20" rx="4" fill="#aaa" opacity="0.4"/>
</svg>`;

const impactSVG = `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
  <polygon points="50,5 61,35 95,35 67,55 78,90 50,68 22,90 33,55 5,35 39,35" fill="#ffcc00" opacity="0.8"/>
</svg>`;

// Preload images
IMAGES.forEach(src => { const img = new Image(); img.src = src; });

// ================================================================
//  SPEED
// ================================================================
function getShowTime() {
  return Math.max(400, 2500 - totalWhacks * 40);
}
function getSpawnDelay() {
  return Math.max(100, 500 - totalWhacks * 10);
}
function getSpeedTier() {
  if (totalWhacks < 8)  return 'EASY';
  if (totalWhacks < 18) return 'MEDIUM';
  if (totalWhacks < 30) return 'FAST';
  if (totalWhacks < 45) return 'INSANE';
  return 'IMPOSSIBLE';
}

// ================================================================
//  LIVES
// ================================================================
function updateLives() {
  let html = '';
  for (let i = 0; i < MAX_LIVES; i++) {
    html += i < lives ? '\u2764\uFE0F' : '<span class="lost">\uD83D\uDDA4</span>';
  }
  livesDisplay.innerHTML = html;
}

// ================================================================
//  ALEX JONES HYPE
// ================================================================
function alexSay(textCategory, audioCategory) {
  const quotes = ALEX_QUOTES[textCategory];
  alexQuote.textContent = quotes[Math.floor(Math.random() * quotes.length)];
  alexImg.classList.remove('hyped');
  void alexImg.offsetWidth;
  alexImg.classList.add('hyped');
  setTimeout(() => alexImg.classList.remove('hyped'), 500);
  if (audioCategory) playAlexClip(audioCategory);
}

// ================================================================
//  BLOOD EFFECTS
// ================================================================
function spawnBlood(hole, x, y, intensity) {
  const count = intensity === 'groin' ? 22 : intensity === 'head' ? 16 : 10;
  for (let i = 0; i < count; i++) {
    const drop = document.createElement('div');
    drop.classList.add('blood-drop');
    const angle = Math.random() * Math.PI * 2;
    const dist = 30 + Math.random() * 70;
    const tx = Math.cos(angle) * dist;
    const ty = Math.sin(angle) * dist - 20;
    const sc = 0.5 + Math.random() * 2.5;
    const dur = 0.3 + Math.random() * 0.5;
    const size = 6 + Math.random() * 12;
    drop.style.cssText = `left:${x}px;top:${y}px;--tx:${tx}px;--ty:${ty}px;--sc:${sc};--dur:${dur}s;
      width:${size}px;height:${size}px;
      background:hsl(${Math.random()*10}, 100%, ${12 + Math.random()*20}%);`;
    hole.appendChild(drop);
    setTimeout(() => drop.remove(), dur * 1000);
  }
  const splat = document.createElement('div');
  splat.classList.add('blood-splat');
  const size = intensity === 'groin' ? 100 : intensity === 'head' ? 80 : 55;
  splat.style.cssText = `left:${x}px;top:${y}px;width:${size}px;height:${size}px;`;
  splat.innerHTML = `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
    <circle cx="50" cy="50" r="42" fill="#8b0000" opacity="0.8"/>
    <circle cx="30" cy="35" r="18" fill="#6b0000" opacity="0.6"/>
    <circle cx="65" cy="60" r="22" fill="#5b0000" opacity="0.5"/>
    <circle cx="50" cy="25" r="12" fill="#9b0000" opacity="0.5"/>
    <circle cx="70" cy="30" r="8" fill="#7b0000" opacity="0.4"/>
  </svg>`;
  hole.appendChild(splat);
  setTimeout(() => splat.remove(), 500);
}

// ================================================================
//  BUILD BOARD
// ================================================================
for (let i = 0; i < HOLES; i++) {
  const hole = document.createElement('div');
  hole.classList.add('hole');
  hole.dataset.index = i;
  const mole = document.createElement('div');
  mole.classList.add('mole');
  const img = document.createElement('img');
  img.src = IMAGES[0]; img.draggable = false;
  mole.appendChild(img);
  hole.appendChild(mole);
  hole.addEventListener('click', (e) => whack(i, e));
  board.appendChild(hole);
}

const holes = document.querySelectorAll('.hole');
const moles = document.querySelectorAll('.mole');

function randomHole() {
  let idx;
  do { idx = Math.floor(Math.random() * HOLES); } while (idx === lastHole);
  lastHole = idx;
  return idx;
}

function getHitZone(e, moleEl) {
  const rect = moleEl.getBoundingClientRect();
  const relY = (e.clientY - rect.top) / rect.height;
  if (relY < 0.30) return 'head';
  if (relY > 0.75) return 'groin';
  return 'body';
}

function getMultiplier(zone) {
  if (zone === 'head')  return 2;
  if (zone === 'groin') return 5;
  return 1;
}

function getZoneLabel(zone, pts) {
  if (zone === 'head')  return `HEADSHOT! +${pts}`;
  if (zone === 'groin') return `GROIN SHOT! +${pts}`;
  return `+${pts}`;
}

function spawnHammer(hole, e) {
  const rect = hole.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  const hammer = document.createElement('div');
  hammer.classList.add('hammer');
  hammer.innerHTML = hammerSVG;
  hammer.style.left = x + 'px'; hammer.style.top = y + 'px';
  hole.appendChild(hammer);
  setTimeout(() => hammer.remove(), 350);

  const impact = document.createElement('div');
  impact.classList.add('impact');
  impact.innerHTML = impactSVG;
  impact.style.left = x + 'px'; impact.style.top = y + 'px';
  hole.appendChild(impact);
  setTimeout(() => impact.remove(), 300);
}

function showMole() {
  if (!running) return;
  const idx = randomHole();
  const mole = moles[idx];
  const img = mole.querySelector('img');
  img.src = IMAGES[Math.floor(Math.random() * IMAGES.length)];
  mole.classList.remove('bonked', 'shake');
  mole.style.filter = '';
  mole.classList.add('up');
  mole.dataset.hit = 'false';
  round++;

  const showTime = getShowTime();
  speedLabel.textContent = getSpeedTier();

  moleTimeout = setTimeout(() => {
    if (mole.dataset.hit === 'false' && mole.classList.contains('up')) {
      mole.classList.remove('up');
      lives--;
      updateLives();
      combo = 0;
      comboEl.textContent = combo;
      holes[idx].classList.add('miss-flash');
      setTimeout(() => holes[idx].classList.remove('miss-flash'), 400);
      document.body.classList.add('life-lost-flash');
      setTimeout(() => document.body.classList.remove('life-lost-flash'), 500);
      playMissSound();
      alexSay('miss', 'miss');

      if (lives <= 0) {
        endGame();
        return;
      }
    }
    if (running) setTimeout(showMole, getSpawnDelay());
  }, showTime);
}

function whack(idx, e) {
  if (!running) return;
  const mole = moles[idx];
  if (!mole.classList.contains('up') || mole.dataset.hit === 'true') return;

  if (audioCtx.state === 'suspended') audioCtx.resume();

  const zone = getHitZone(e, mole);
  const mult = getMultiplier(zone);
  const pts = 10 * mult;

  mole.dataset.hit = 'true';
  totalWhacks++;

  const rect = holes[idx].getBoundingClientRect();
  const cx = e.clientX - rect.left;
  const cy = e.clientY - rect.top;

  spawnHammer(holes[idx], e);
  spawnBlood(holes[idx], cx, cy, zone);
  playWhack(zone);

  if (zone === 'groin' || zone === 'head') {
    document.body.classList.remove('screen-shake');
    void document.body.offsetWidth;
    document.body.classList.add('screen-shake');
    setTimeout(() => document.body.classList.remove('screen-shake'), 200);
  }

  mole.classList.add('shake');
  mole.style.filter = 'brightness(0.3) saturate(0) sepia(1) hue-rotate(-30deg)';
  setTimeout(() => {
    mole.classList.remove('up', 'shake');
    mole.style.filter = '';
  }, 400);

  combo++;
  if (combo > bestCombo) bestCombo = combo;
  comboEl.textContent = combo;

  score += pts;
  if (zone === 'head') headshots++;
  else if (zone === 'groin') groinshots++;
  else bodyshots++;
  scoreEl.textContent = score;

  if (combo >= 4) {
    alexSay('combo', 'combo');
  } else if (zone === 'groin' || zone === 'head') {
    alexSay(zone, 'bigHit');
  } else {
    alexSay('body', 'hit');
  }

  const pop = document.createElement('div');
  pop.classList.add('score-pop', zone);
  pop.textContent = getZoneLabel(zone, pts);
  if (combo > 2) pop.textContent += ` (${combo}x combo!)`;
  holes[idx].appendChild(pop);
  setTimeout(() => pop.remove(), 800);
}

function startGame() {
  score = 0; combo = 0; bestCombo = 0; round = 0; totalWhacks = 0;
  headshots = 0; bodyshots = 0; groinshots = 0;
  lives = MAX_LIVES; lastHole = -1;
  scoreEl.textContent = 0;
  comboEl.textContent = 0;
  updateLives();
  speedLabel.textContent = 'EASY';
  gameOver.style.display = 'none';
  startBtn.style.display = 'none';
  running = true;

  if (audioCtx.state === 'suspended') audioCtx.resume();
  alexSay('start', 'start');

  // Start/resume music if enabled
  if (bgMusic && musicEnabled) {
    bgMusic.play().catch(() => {});
  }

  setTimeout(showMole, 1000);
}

function endGame() {
  running = false;
  clearTimeout(moleTimeout);
  moles.forEach(m => {
    m.classList.remove('up', 'bonked', 'shake');
    m.style.filter = '';
  });

  finalScore.textContent = score;
  finalHead.textContent = headshots;
  finalBody.textContent = bodyshots;
  finalGroin.textContent = groinshots;
  finalCombo.textContent = bestCombo;
  finalRound.textContent = round;

  alexSay('end', null);

  if (score >= 500) verdict.textContent = '"The whole island is clean. Justice served."';
  else if (score >= 300) verdict.textContent = '"Solid work. The elites are shaking."';
  else if (score >= 150) verdict.textContent = '"Not bad. Keep fighting the good fight."';
  else verdict.textContent = '"The cover-up continues... try harder."';

  gameOver.style.display = 'flex';
}

startBtn.addEventListener('click', startGame);
restartBtn.addEventListener('click', startGame);
</script>
</body>
</html>
